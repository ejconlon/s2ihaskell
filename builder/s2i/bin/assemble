#!/bin/bash
set -eux

# restore build artifacts
if [ -d /tmp/artifacts/.stack ]; then
    echo "Restoring stack home"
    mv /tmp/artifacts/.stack ${HOME}/.stack
fi
if [ -d /tmp/artifacts/.stack-work ]; then
    echo "Restoring stack work"
    mv /tmp/artifacts/.stack-work /tmp/src/.stack-work
fi

# build application artifacts
pushd /tmp/src
    echo "Building project"
    stack build --allow-different-user --test --haddock --no-run-tests --copy-bins
popd
